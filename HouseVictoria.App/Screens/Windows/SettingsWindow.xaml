<Window x:Class="HouseVictoria.App.Screens.Windows.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:HouseVictoria.App.Converters"
        mc:Ignorable="d"
        Title="Settings" Height="1000" Width="1200"
        Style="{StaticResource OverlayWindow}"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Window.Resources>

    <Border Background="Transparent">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#3000D4FF" Padding="15,10" CornerRadius="6,6,0,0" MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Border.Effect>
                    <DropShadowEffect Color="#00D4FF" BlurRadius="10" ShadowDepth="0" Opacity="0.3"/>
                </Border.Effect>
                <Grid>
                    <TextBlock Text="âš™ï¸ Configuration Settings" FontSize="20" FontWeight="Bold" Foreground="#E0F7FF"/>
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                        <Button Content="âˆ’" 
                               Width="30" Height="30" 
                               Background="#4000D4FF" 
                               BorderThickness="0"
                               FontSize="18" FontWeight="Bold"
                               Foreground="#E0F7FF"
                               Cursor="Hand"
                               Margin="0,0,5,0"
                               Click="MinimizeButton_Click"
                               ToolTip="Minimize to Tray">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                       CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                     VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#6000D4FF"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="âœ•" 
                               Width="30" Height="30" 
                               Background="#40FF3366" 
                               BorderThickness="0"
                               FontSize="16" FontWeight="Bold"
                               Foreground="#E0F7FF"
                               Cursor="Hand"
                               Click="CloseButton_Click"
                               ToolTip="Close">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                       CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                     VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#60FF3366"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Settings Categories (scrollable) -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="10">
                <StackPanel>
                    <!-- SMS/MMS Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ“± SMS/MMS Communication" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <TextBlock Text="Configure SMS and MMS settings" FontSize="12" Foreground="#80C4D4"/>
                        </StackPanel>
                    </Border>

                    <!-- MCP Server Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ”Œ MCP Server" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Endpoint:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding MCPServerEndpoint, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding MCPServerConnectionStatus}" 
                                          VerticalAlignment="Center" Margin="5,0" FontWeight="Bold"
                                          Visibility="{Binding MCPServerConnectionStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding MCPServerConnectionStatus}" Value="âœ— Failed">
                                                    <Setter Property="Foreground" Value="#FF3366"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding MCPServerConnectionStatus}" Value="Testing...">
                                                    <Setter Property="Foreground" Value="#FFAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Grid.Column="3" Content="Test" Style="{StaticResource GlassButton}" 
                                       Command="{Binding TestMCPConnectionCommand}" 
                                       Width="80" Margin="5,0" IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- TTS Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ”Š Text-to-Speech" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Endpoint:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding TTSEndpoint, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding TTSConnectionStatus}" 
                                          Foreground="#00FF88" 
                                          VerticalAlignment="Center" Margin="5,0" FontWeight="Bold"
                                          Visibility="{Binding TTSConnectionStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TTSConnectionStatus}" Value="âœ— Failed">
                                                    <Setter Property="Foreground" Value="#FF3366"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TTSConnectionStatus}" Value="Testing...">
                                                    <Setter Property="Foreground" Value="#FFAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Grid.Column="3" Content="Test" Style="{StaticResource GlassButton}" 
                                       Command="{Binding TestTTSConnectionCommand}" 
                                       Width="80" Margin="5,0" IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Stable Diffusion / ComfyUI Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸŽ¨ Stable Diffusion / ComfyUI" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <TextBlock Text="Configure Stable Diffusion or ComfyUI endpoint for image generation" FontSize="12" Foreground="#CCCCCC" Margin="0,0,0,5"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Endpoint:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding StableDiffusionEndpoint, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding StableDiffusionConnectionStatus}" 
                                          VerticalAlignment="Center" Margin="5,0" FontWeight="Bold"
                                          Visibility="{Binding StableDiffusionConnectionStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StableDiffusionConnectionStatus}" Value="âœ— Failed">
                                                    <Setter Property="Foreground" Value="#FF3366"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StableDiffusionConnectionStatus}" Value="Testing...">
                                                    <Setter Property="Foreground" Value="#FFAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Grid.Column="3" Content="Test" Style="{StaticResource GlassButton}" 
                                       Command="{Binding TestStableDiffusionConnectionCommand}" 
                                       Width="80" Margin="5,0" IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                            <TextBlock Text="Default: http://localhost:8188 (ComfyUI) or http://localhost:7860 (Automatic1111)" 
                                      FontSize="11" Foreground="#5A6A7A" Margin="0,5,0,0" FontStyle="Italic"/>
                        </StackPanel>
                    </Border>

                    <!-- Tools Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ› ï¸ Tools" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <TextBlock Text="Configure available AI tools and functions" FontSize="12" Foreground="#80C4D4"/>
                        </StackPanel>
                    </Border>

                    <!-- Virtual Environment Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸŒ Virtual Environment (Unreal Engine)" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Endpoint:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding UnrealEngineEndpoint, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding UnrealConnectionStatus}" 
                                          Foreground="#00FF88" 
                                          VerticalAlignment="Center" Margin="5,0" FontWeight="Bold"
                                          Visibility="{Binding UnrealConnectionStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding UnrealConnectionStatus}" Value="âœ— Failed">
                                                    <Setter Property="Foreground" Value="#FF3366"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding UnrealConnectionStatus}" Value="Testing...">
                                                    <Setter Property="Foreground" Value="#FFAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Grid.Column="3" Content="Test" Style="{StaticResource GlassButton}" 
                                       Command="{Binding TestUnrealConnectionCommand}" 
                                       Width="80" Margin="5,0" IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                            <TextBlock Text="Configure avatar locomotion, physical interactions, and virtual world settings" 
                                      FontSize="12" Foreground="#80C4D4" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- LLM Server Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ§  LLM Server (Ollama)" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Endpoint:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding OllamaEndpoint, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding OllamaConnectionStatus}" 
                                          Foreground="#00FF88" 
                                          VerticalAlignment="Center" Margin="5,0" FontWeight="Bold"
                                          Visibility="{Binding OllamaConnectionStatus, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding OllamaConnectionStatus}" Value="âœ— Failed">
                                                    <Setter Property="Foreground" Value="#FF3366"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding OllamaConnectionStatus}" Value="Testing...">
                                                    <Setter Property="Foreground" Value="#FFAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Grid.Column="3" Content="Test" Style="{StaticResource GlassButton}" 
                                       Command="{Binding TestOllamaConnectionCommand}" 
                                       Width="80" Margin="5,0" IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Overlay Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ–¥ï¸ Overlay Settings" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Enable Overlay:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnableOverlay}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Overlay Opacity:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="0.1" Maximum="1.0" Value="{Binding OverlayOpacity}" 
                                       TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Auto-Hide Trays:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding AutoHideTrays}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Auto-Hide Delay (ms):" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding AutoHideDelayMs, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Avatar Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ‘¤ Avatar Settings" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Model Path:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding AvatarModelPath, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Voice Model:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <ComboBox Grid.Column="1" 
                                         ItemsSource="{Binding AvailableVoices}"
                                         SelectedItem="{Binding AvatarVoiceModel, UpdateSourceTrigger=PropertyChanged}"
                                         IsEditable="True"
                                         Background="#252F3F" BorderBrush="#4000D4FF" 
                                         Foreground="#E0F7FF" Padding="8" Margin="5,0,5,0"
                                         IsEnabled="{Binding IsLoadingVoices, Converter={StaticResource InverseBoolConverter}}"/>
                                <Button Grid.Column="2" 
                                       Content="ðŸ”„" 
                                       ToolTip="Refresh voice list"
                                       Command="{Binding LoadVoicesCommand}"
                                       Background="#252F3F" BorderBrush="#4000D4FF"
                                       Foreground="#E0F7FF" Padding="8,4" Margin="5,0"
                                       Width="35"
                                       IsEnabled="{Binding IsLoadingVoices, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Voice Speed:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.1" Maximum="3.0" Value="{Binding AvatarVoiceSpeed}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding AvatarVoiceSpeed, StringFormat='Speed: {0:F1}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Voice Pitch:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.1" Maximum="3.0" Value="{Binding AvatarVoicePitch}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding AvatarVoicePitch, StringFormat='Pitch: {0:F1}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Locomotion Settings -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸš¶ Locomotion Settings" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Walk Speed:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.1" Maximum="10.0" Value="{Binding WalkSpeed}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding WalkSpeed, StringFormat='Speed: {0:F1}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Run Speed:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.1" Maximum="20.0" Value="{Binding RunSpeed}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding RunSpeed, StringFormat='Speed: {0:F1}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Jump Height:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.1" Maximum="10.0" Value="{Binding JumpHeight}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding JumpHeight, StringFormat='Height: {0:F1}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Enable Physics:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnablePhysicsInteraction}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Tools Configuration -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ› ï¸ Tools Configuration" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="File System Access:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnableFileSystemAccess}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Network Access:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnableNetworkAccess}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="System Commands:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnableSystemCommands}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Persistent Memory Configuration -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <TextBlock Text="ðŸ’¾ Persistent Memory Configuration" FontSize="16" FontWeight="Bold" Foreground="#00D4FF"/>
                            <Separator Margin="0,5" Background="#1A2332"/>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Enable Memory:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding EnablePersistentMemory}" 
                                         Foreground="#E0F7FF" VerticalAlignment="Center" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Memory Path:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding PersistentMemoryPath, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Max Entries:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding MemoryMaxEntries, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Importance Threshold:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <StackPanel Grid.Column="1" Margin="5,0">
                                    <Slider Minimum="0.0" Maximum="1.0" Value="{Binding MemoryImportanceThreshold}" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           Foreground="#00D4FF" Background="#CC222222"/>
                                    <TextBlock Text="{Binding MemoryImportanceThreshold, StringFormat='Threshold: {0:F2}'}" 
                                             Foreground="#80C4D4" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Grid>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Retention Days:" Foreground="#E0F7FF" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding MemoryRetentionDays, UpdateSourceTrigger=PropertyChanged}" 
                                        Background="#252F3F" BorderBrush="#4000D4FF" 
                                        Foreground="#E0F7FF" Padding="8" Margin="5,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Validation Error Display -->
                    <Border Style="{StaticResource Card}" Margin="0,5" Background="#33FF3366" BorderBrush="#FF3366" BorderThickness="1"
                           Visibility="{Binding ValidationError, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Margin="10">
                            <TextBlock Text="âš ï¸ Validation Error" FontSize="14" FontWeight="Bold" Foreground="#FF3366"/>
                            <TextBlock Text="{Binding ValidationError}" Foreground="#E0F7FF" TextWrapping="Wrap" Margin="0,5,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="MaxHeight" Value="60"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="MaxHeight" Value="300"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Connection Test Result Display -->
                    <Border Style="{StaticResource Card}" Margin="0,5" 
                           Background="#3300FF88" BorderBrush="#00FF88" BorderThickness="1"
                           Visibility="{Binding ConnectionTestResult, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Margin="10">
                            <TextBlock Text="{Binding ConnectionTestResult}" Foreground="#E0F7FF" FontSize="12" FontWeight="Bold" TextWrapping="Wrap">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="MaxHeight" Value="60"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="MaxHeight" Value="300"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Action Buttons -->
                    <Border Style="{StaticResource Card}" Margin="0,5">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,10">
                                <Button Style="{StaticResource GlassButton}" 
                                       Content="ðŸ”„ Reset" 
                                       Command="{Binding ResetToDefaultsCommand}"
                                       Width="120" Height="35" Margin="0,0,10,0"
                                       ToolTip="Reset all settings to default values"/>
                                <Button Style="{StaticResource GlassButton}" 
                                       Content="ðŸ“¥ Import" 
                                       Command="{Binding ImportSettingsCommand}"
                                       Width="120" Height="35" Margin="0,0,10,0"/>
                                <Button Style="{StaticResource GlassButton}" 
                                       Content="ðŸ“¤ Export" 
                                       Command="{Binding ExportSettingsCommand}"
                                       Width="120" Height="35" Margin="0,0,10,0"/>
                                <Button Style="{StaticResource GlassButton}" 
                                       Content="ðŸ’¾ Save Settings" 
                                       Click="SaveButton_Click"
                                       Width="200" Height="35"
                                       IsEnabled="{Binding IsValid}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Border>

</Window>
